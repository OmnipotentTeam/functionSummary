<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhxx.service.szxt.mapper.StudentEntityMapper">
  <resultMap id="BaseResultMap" type="com.zhxx.service.szxt.entity.StudentEntity">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="student_id" jdbcType="VARCHAR" property="studentId" />
    <result column="mMarkId" jdbcType="VARCHAR" property="mMarkId" />
    <result column="aSolutionID" jdbcType="VARCHAR" property="aSolutionID" />
    <result column="aProblemId" jdbcType="VARCHAR" property="aProblemId" />
    <result column="student_no" jdbcType="VARCHAR" property="studentNo" />
    <result column="student_name" jdbcType="VARCHAR" property="studentName" />
    <result column="student_sex" jdbcType="VARCHAR" property="studentSex" />
    <result column="student_age" jdbcType="INTEGER" property="studentAge" />
    <result column="student_phone_number" jdbcType="VARCHAR" property="studentPhoneNumber" />
    <result column="student_grade" jdbcType="INTEGER" property="studentGrade" />
    <result column="student_binding_code" jdbcType="VARCHAR" property="studentBindingCode" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="modify_time" jdbcType="TIMESTAMP" property="modifyTime" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="student_binding" jdbcType="INTEGER" property="studentBinding" />
    <result column="major_id" jdbcType="VARCHAR" property="majorId" />
    <result column="major_name" jdbcType="VARCHAR" property="majorName" />
    <result column="student_retardation" jdbcType="INTEGER" property="retardation" />
    <result column="start_school" jdbcType="VARCHAR" property="startSchool" /> 
    <result column="head_img" jdbcType="VARCHAR" property="headImg" /> 
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    student_id, student_no, student_name, student_sex, student_age, student_phone_number, 
    student_grade, create_time, modify_time, status, major_id,head_img
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from student
    where student_id = #{studentId,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from student
    where student_id = #{studentId,jdbcType=VARCHAR}
  </delete>

  <insert id="insertBindCode" parameterType="com.zhxx.service.szxt.entity.StudentEntity">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into student (student_binding)
    values (#{studentBinding,jdbcType=VARCHAR})
  </insert>

  <insert id="insert" parameterType="com.zhxx.service.szxt.entity.StudentEntity">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into student (student_id, student_no, student_name, 
      student_sex, student_age, student_phone_number, 
      student_grade, create_time, modify_time, 
      status, major_id)
    values (#{studentId,jdbcType=VARCHAR}, #{studentNo,jdbcType=VARCHAR}, #{studentName,jdbcType=VARCHAR}, 
      #{studentSex,jdbcType=VARCHAR}, #{studentAge,jdbcType=INTEGER}, #{studentPhoneNumber,jdbcType=VARCHAR}, 
      #{studentGrade,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP}, #{modifyTime,jdbcType=TIMESTAMP}, 
      #{status,jdbcType=INTEGER}, #{majorId,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.zhxx.service.szxt.entity.StudentEntity">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into student
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="studentId != null">
        student_id,
      </if>
      <if test="studentNo != null">
        student_no,
      </if>
      <if test="studentName != null">
        student_name,
      </if>
      <if test="studentSex != null">
        student_sex,
      </if>
      <if test="studentAge != null">
        student_age,
      </if>
      <if test="studentPhoneNumber != null">
        student_phone_number,
      </if>
      <if test="studentGrade != null">
        student_grade,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="modifyTime != null">
        modify_time,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="majorId != null">
        major_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="studentId != null">
        #{studentId,jdbcType=VARCHAR},
      </if>
      <if test="studentNo != null">
        #{studentNo,jdbcType=VARCHAR},
      </if>
      <if test="studentName != null">
        #{studentName,jdbcType=VARCHAR},
      </if>
      <if test="studentSex != null">
        #{studentSex,jdbcType=VARCHAR},
      </if>
      <if test="studentAge != null">
        #{studentAge,jdbcType=INTEGER},
      </if>
      <if test="studentPhoneNumber != null">
        #{studentPhoneNumber,jdbcType=VARCHAR},
      </if>
      <if test="studentGrade != null">
        #{studentGrade,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyTime != null">
        #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        #{status,jdbcType=INTEGER},
      </if>
      <if test="majorId != null">
        #{majorId,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.zhxx.service.szxt.entity.StudentEntity">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update student
    <set>
      <if test="studentNo != null">
        student_no = #{studentNo,jdbcType=VARCHAR},
      </if>
      <if test="studentName != null">
        student_name = #{studentName,jdbcType=VARCHAR},
      </if>
      <if test="studentSex != null">
        student_sex = #{studentSex,jdbcType=VARCHAR},
      </if>
      <if test="studentAge != null">
        student_age = #{studentAge,jdbcType=INTEGER},
      </if>
      <if test="studentPhoneNumber != null">
        student_phone_number = #{studentPhoneNumber,jdbcType=VARCHAR},
      </if>
      <if test="studentGrade != null">
        student_grade = #{studentGrade,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyTime != null">
        modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="majorId != null">
        major_id = #{majorId,jdbcType=VARCHAR},
      </if>
      <if test="retardation != null">
        student_retardation = #{retardation,jdbcType=INTEGER},
      </if>
      <if test="headImg != null">
        head_img = #{headImg,jdbcType=INTEGER},
      </if>
    </set>
    where student_id = #{studentId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.zhxx.service.szxt.entity.StudentEntity">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update student
    set student_no = #{studentNo,jdbcType=VARCHAR},
      student_name = #{studentName,jdbcType=VARCHAR},
      student_sex = #{studentSex,jdbcType=VARCHAR},
      student_age = #{studentAge,jdbcType=INTEGER},
      student_phone_number = #{studentPhoneNumber,jdbcType=VARCHAR},
      student_grade = #{studentGrade,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      status = #{status,jdbcType=INTEGER},
      major_id = #{majorId,jdbcType=VARCHAR},
      head_img = #{headImg,jdbcType=INTEGER}
    where student_id = #{studentId,jdbcType=VARCHAR}
  </update>

  <insert id="addStudent" parameterType="com.zhxx.service.szxt.entity.StudentEntity">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into student (student_id, student_no, student_name,
    student_sex, student_age, student_phone_number,
    student_grade, create_time, modify_time,
    status, major_id,student_retardation,start_school)
    values (#{studentId,jdbcType=VARCHAR}, #{studentNo,jdbcType=VARCHAR}, #{studentName,jdbcType=VARCHAR},
    #{studentSex,jdbcType=VARCHAR}, #{studentAge,jdbcType=INTEGER}, #{studentPhoneNumber,jdbcType=VARCHAR},
    #{studentGrade,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP}, #{modifyTime,jdbcType=TIMESTAMP},
    #{status,jdbcType=INTEGER}, #{majorId,jdbcType=VARCHAR}, #{retardation,jdbcType=INTEGER},#{startSchool,jdbcType=VARCHAR})
  </insert>

  <!--
      修改人 王传营  2020-01-14
    -->
  <select id="selectStudent" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    student.student_id, student.student_no, student.student_name, student.student_sex, student.student_age, student.student_phone_number,
    student.student_grade,student.student_binding_code, student.create_time, student.modify_time, student.status, student.major_id ,student.student_retardation,major.major_name major_name,head_img
    from student,major
    where student_id = #{studentId,jdbcType=VARCHAR}
    AND student.major_id=major.major_id
  </select>
	<select id="selectByStudent" parameterType="com.zhxx.service.szxt.entity.StudentEntity" resultMap="BaseResultMap">
	    <!--
	      WARNING - @mbg.generated
	      This element is automatically generated by MyBatis Generator, do not modify.
	    -->
	    select
	    student.student_id, student.student_no, student.student_name, student.student_sex, student.student_age, student.student_phone_number,
	    student.student_grade,student.student_binding_code, student.create_time, student.modify_time, student.status, student.major_id ,student.student_retardation,major.major_name major_name,head_img
	    from student,major
	    <where>
		    student.major_id=major.major_id
		    <if test="studentId != null and studentId !=''">
		       and student_id = #{studentId,jdbcType=VARCHAR}
		    </if>
		    <if test="studentNo != null and studentNo !=''">
		       and student_no = #{studentNo,jdbcType=VARCHAR}
		    </if>
	    </where>
	  </select>
  <!--
    修改人 王传营  2020-01-14
  -->
  <update id="updateStudentInformation" parameterType="com.zhxx.service.szxt.entity.StudentEntity">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update student
    <set>
      <if test="studentNo != null and studentNo != '' ">
        student_no = #{studentNo,jdbcType=VARCHAR},
      </if>
      <if test="studentName != null and studentName != '' ">
        student_name = #{studentName,jdbcType=VARCHAR},
      </if>
      <if test="studentSex != null and studentSex != '' ">
        student_sex = #{studentSex,jdbcType=VARCHAR},
      </if>
      <if test="studentAge != null and studentAge != '' ">
        student_age = #{studentAge,jdbcType=INTEGER},
      </if>
      <if test="studentPhoneNumber != null and studentPhoneNumber != '' ">
        student_phone_number = #{studentPhoneNumber,jdbcType=VARCHAR},
      </if>
      <if test="studentGrade != null and studentGrade != '' ">
        student_grade = #{studentGrade,jdbcType=INTEGER},
      </if>
      <if test="studentBindingCode != null and studentBindingCode != '' ">
        student_binding_code = #{studentBindingCode,jdbcType=INTEGER},
      </if>
      <if test="createTime != null and createTime != '' ">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyTime != null and modifyTime != '' ">
        modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null and status != '' ">
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="majorId != null and majorId != '' ">
        major_id = #{majorId,jdbcType=VARCHAR},
      </if>
       <if test="headImg != null and headImg != '' ">
         head_img = #{headImg,jdbcType=INTEGER},
      </if>
                                                                                                                                                                                               
    </set>
    where student_id = #{studentId,jdbcType=VARCHAR}
  </update>
  <select id="selectStudentAll" parameterType="com.zhxx.service.szxt.entity.StudentEntity" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    student.*,major.major_name
    from student,major
    WHERE
    student.`status` = 1
    AND student.major_id=major.major_id
    <if test="studentNo != null">
      AND student.student_no LIKE '%${studentNo}%'
    </if>
    <if test="studentPhoneNumber != null">
      AND student.student_phone_number  LIKE '%${studentPhoneNumber}%'
    </if>
    <if test="studentGrade != null">
      AND  student.student_grade LIKE '%${studentGrade}%'
    </if>
    <if test="majorId != null">
      AND  student.major_id LIKE '%${majorId}%'
    </if>
    <if test="studentName != null">
      AND  student.student_name LIKE '%${studentName}%'
    </if>
    <if test="startSchool != null">
      AND  student.start_school LIKE '%${startSchool}%'
    </if>
  </select>

  <update id="updateStudentGrade" parameterType="com.zhxx.service.szxt.entity.StudentEntity">
      update student set  student_grade = student_grade+1
  </update>
  <update id="updateStudentRetardation" parameterType="com.zhxx.service.szxt.entity.StudentEntity">
    update student set  student_retardation = 1
  </update>


    <delete id="deleteStudent" parameterType="com.zhxx.service.szxt.entity.StudentEntity">
        DELETE FROM student WHERE student.student_id = #{studentId,jdbcType=VARCHAR};
        DELETE FROM student_change WHERE student_change.student_id = #{studentId,jdbcType=VARCHAR};
        DELETE FROM mark WHERE mark.student_id = #{studentId,jdbcType=VARCHAR};
        DELETE FROM answer WHERE answer.answer_id = #{studentId,jdbcType=VARCHAR} ;
        DELETE FROM growth_planning WHERE growth_planning.studen_id = #{studentId,jdbcType=VARCHAR};

    </delete>
  <select id="selectAllId" parameterType="com.zhxx.service.szxt.entity.StudentEntity" resultMap="BaseResultMap">
    SELECT
      s.student_name as studentName,
      a.solution_id AS aSolutionID,
      a.problem_id AS aProblemId
    FROM
        student s
    LEFT JOIN student_change sc ON s.student_id = sc.student_id
    LEFT JOIN mark m ON s.student_id = m.student_id
    LEFT JOIN answer a ON s.student_id = m.student_id

    WHERE
        s.student_id = #{studentId,jdbcType=VARCHAR}
  </select>

  <update id="insertupdateStudentBindingCode" parameterType="com.zhxx.service.szxt.entity.StudentEntity">
    update student set  student_binding_code = #{studentBindingCode,jdbcType=VARCHAR} where student_id = #{studentId,jdbcType=VARCHAR}
  </update>
  <update id="updateStudentBindingCode" parameterType="com.zhxx.service.szxt.entity.StudentEntity">
    update student set  student_binding = 1 where student_id = #{studentId,jdbcType=VARCHAR}
  </update>
</mapper>