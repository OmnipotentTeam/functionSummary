<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhxx.service.szxt.mapper.TeacherUserEntityMapper">
  <resultMap id="BaseResultMap" type="com.zhxx.service.szxt.entity.TeacherUserEntity">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="teacher_id" jdbcType="VARCHAR" property="teacherId" />
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
    <result column="password" jdbcType="VARCHAR" property="password" />
    <result column="teacher_phone_number" jdbcType="VARCHAR" property="teacherPhoneNumber" />
    <result column="teacher_email" jdbcType="VARCHAR" property="teacherEmail" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="modify_time" jdbcType="TIMESTAMP" property="modifyTime" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="teacher_no" jdbcType="VARCHAR" property="teacherNo" />
    <result column="teacher_openid" jdbcType="VARCHAR" property="teacherOpenid" />
    <result column="college" jdbcType="VARCHAR" property="college" />
    <result column="major" jdbcType="VARCHAR" property="major" />
    <result column="allow_check_time" jdbcType="TIMESTAMP" property="allowCheckTime" />
    <result column="paperCount" jdbcType="VARCHAR" property="paperCount" />
    <result column="writingsCount" jdbcType="VARCHAR" property="writingsCount" />
    <result column="projectCount" jdbcType="VARCHAR" property="projectCount" />
    <result column="concludingCount" jdbcType="VARCHAR" property="concludingCount" />
    <result column="horizontalCount" jdbcType="VARCHAR" property="horizontalCount" />
    <result column="prizeCount" jdbcType="VARCHAR" property="prizeCount" />
    <result column="patentCount" jdbcType="VARCHAR" property="patentCount" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    teacher_id, user_name, password, teacher_phone_number, teacher_email, create_time, 
    modify_time, status, teacher_no, teacher_openid, college, major,allow_check_time
  </sql>
  <select id="selectByPrimaryKey" parameterType="com.zhxx.service.szxt.entity.TeacherUserEntity" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from teacher_user
    where teacher_id = #{teacherId,jdbcType=VARCHAR}
  </select>
  <select id="selectOpenId" parameterType="com.zhxx.service.szxt.entity.TeacherUserEntity" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    teacher_id as teacherId
    from teacher_user
    where teacher_id = #{teacherId,jdbcType=VARCHAR}
  </select>
  <select id="selectByTeacherNo" parameterType="java.lang.String" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from teacher_user
    where teacher_no = #{teacherNo,jdbcType=VARCHAR}
  </select>
   <select id="selectTeacherList" parameterType="com.zhxx.service.szxt.entity.TeacherUserEntity" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from teacher_user
    <where>
      <if test="teacherId != null and teacherId != ''">
         and teacher_id = #{teacherId,jdbcType=VARCHAR}
      </if>
      <if test="teacherNo != null and teacherNo != ''">
          and teacher_no LIKE '%${teacherNo}%'
      </if>
      <if test="college != null and college != ''">
         and college = #{college,jdbcType=VARCHAR}
      </if>
      <if test="major != null and major != ''">
         and major = #{major,jdbcType=VARCHAR}
      </if>
      <if test="userName != null and userName != ''">
         and user_name LIKE '%${userName}%'
      </if>
    </where>
    </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from teacher_user
    where teacher_no = #{teacherNo,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.zhxx.service.szxt.entity.TeacherUserEntity">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into teacher_user (teacher_id, user_name, password, 
      teacher_phone_number, teacher_email, create_time, 
      modify_time, status, teacher_no, 
      teacher_openid, college, major
      )
    values (#{teacherId,jdbcType=INTEGER}, #{userName,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR}, 
      #{teacherPhoneNumber,jdbcType=VARCHAR}, #{teacherEmail,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, 
      #{modifyTime,jdbcType=TIMESTAMP}, #{status,jdbcType=INTEGER}, #{teacherNo,jdbcType=VARCHAR}, 
      #{teacherOpenid,jdbcType=VARCHAR}, #{college,jdbcType=VARCHAR}, #{major,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.zhxx.service.szxt.entity.TeacherUserEntity">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into teacher_user
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="teacherId != null">
        teacher_id,
      </if>
      <if test="userName != null">
        user_name,
      </if>
      <if test="password != null">
        password,
      </if>
      <if test="teacherPhoneNumber != null">
        teacher_phone_number,
      </if>
      <if test="teacherEmail != null">
        teacher_email,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="modifyTime != null">
        modify_time,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="teacherNo != null">
        teacher_no,
      </if>
      <if test="teacherOpenid != null">
        teacher_openid,
      </if>
      <if test="college != null">
        college,
      </if>
      <if test="major != null">
        major,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="teacherId != null">
        #{teacherId,jdbcType=INTEGER},
      </if>
      <if test="userName != null">
        #{userName,jdbcType=VARCHAR},
      </if>
      <if test="password != null">
        #{password,jdbcType=VARCHAR},
      </if>
      <if test="teacherPhoneNumber != null">
        #{teacherPhoneNumber,jdbcType=VARCHAR},
      </if>
      <if test="teacherEmail != null">
        #{teacherEmail,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyTime != null">
        #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        #{status,jdbcType=INTEGER},
      </if>
      <if test="teacherNo != null">
        #{teacherNo,jdbcType=VARCHAR},
      </if>
      <if test="teacherOpenid != null">
        #{teacherOpenid,jdbcType=VARCHAR},
      </if>
      <if test="college != null">
        #{college,jdbcType=VARCHAR},
      </if>
      <if test="major != null">
        #{major,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.zhxx.service.szxt.entity.TeacherUserEntity">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update teacher_user
    <set>
      <if test="userName != null">
        user_name = #{userName,jdbcType=VARCHAR},
      </if>
      <if test="password != null">
        password = #{password,jdbcType=VARCHAR},
      </if>
      <if test="teacherPhoneNumber != null">
        teacher_phone_number = #{teacherPhoneNumber,jdbcType=VARCHAR},
      </if>
      <if test="teacherEmail != null">
        teacher_email = #{teacherEmail,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyTime != null">
        modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="teacherNo != null">
        teacher_no = #{teacherNo,jdbcType=VARCHAR},
      </if>
      <if test="teacherOpenid != null">
        teacher_openid = #{teacherOpenid,jdbcType=VARCHAR},
      </if>
      <if test="college != null">
        college = #{college,jdbcType=VARCHAR},
      </if>
      <if test="major != null">
        major = #{major,jdbcType=VARCHAR},
      </if>
      <if test="allowCheckTime != null">
        allow_check_time = #{allowCheckTime,jdbcType=VARCHAR},
      </if>
    </set>
    where teacher_id = #{teacherId,jdbcType=INTEGER}
  </update>
  <update id="updateByTeacherNo" parameterType="com.zhxx.service.szxt.entity.TeacherUserEntity">
    update teacher_user
    <set>
      <if test="userName != null">
        user_name = #{userName,jdbcType=VARCHAR},
      </if>
      <if test="password != null">
        password = #{password,jdbcType=VARCHAR},
      </if>
      <if test="teacherPhoneNumber != null">
        teacher_phone_number = #{teacherPhoneNumber,jdbcType=VARCHAR},
      </if>
      <if test="teacherEmail != null">
        teacher_email = #{teacherEmail,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyTime != null">
        modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="teacherNo != null">
        teacher_no = #{teacherNo,jdbcType=VARCHAR},
      </if>
      <if test="teacherOpenid != null">
        teacher_openid = #{teacherOpenid,jdbcType=VARCHAR},
      </if>
      <if test="college != null">
        college = #{college,jdbcType=VARCHAR},
      </if>
      <if test="major != null">
        major = #{major,jdbcType=VARCHAR},
      </if>
    </set>
    where teacher_no = #{teacherNo,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.zhxx.service.szxt.entity.TeacherUserEntity">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update teacher_user
    set user_name = #{userName,jdbcType=VARCHAR},
      password = #{password,jdbcType=VARCHAR},
      teacher_phone_number = #{teacherPhoneNumber,jdbcType=VARCHAR},
      teacher_email = #{teacherEmail,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      status = #{status,jdbcType=INTEGER},
      teacher_no = #{teacherNo,jdbcType=VARCHAR},
      teacher_openid = #{teacherOpenid,jdbcType=VARCHAR},
      college = #{college,jdbcType=VARCHAR},
      major = #{major,jdbcType=VARCHAR}
    where teacher_id = #{teacherId,jdbcType=INTEGER}
  </update>
   <select id="selectTeacherOutput" parameterType="com.zhxx.service.szxt.entity.TeacherUserEntity" resultMap="BaseResultMap">
    SELECT
		  tu.teacher_id as teacher_id,
	      tu.teacher_no as teacher_no,
		  tu.user_name as user_name,
		  tu.college as college,
		  tu.major as major,
		  COUNT(DISTINCT tp.id) as paperCount,
		  COUNT(DISTINCT te.id) as writingsCount,
		  COUNT(DISTINCT tpo.id)as projectCount,
		  COUNT(DISTINCT tc.id) as concludingCount,
		  COUNT(DISTINCT th.id) as horizontalCount,
		  COUNT(DISTINCT tpr.id) as prizeCount,
		  COUNT(DISTINCT tpa.id) as patentCount
	FROM
	    teacher_user tu
-- 	    跟operator关联的是teacher_id,不是teacher_no
	LEFT JOIN teacher_paper tp ON tu.teacher_id = tp.operator
	LEFT JOIN teacher_writings te on tu.teacher_id = te.operator
	LEFT JOIN teacher_project tpo on tu.teacher_id = tpo.operator
	LEFT JOIN teacher_concluding tc on tu.teacher_id = tc.operator
	LEFT JOIN teacher_horizontal th on tu.teacher_id = th.operator
	LEFT JOIN teacher_prize tpr on tu.teacher_id = tpr.operator
	LEFT JOIN teacher_patent tpa on tu.teacher_id = tpa.operator
    <where>
      <if test="teacherId != null and teacherId != ''">
         and tu.teacher_id = #{teacherId,jdbcType=VARCHAR}
      </if>
      <if test="teacherNo != null and teacherNo != ''">
          and tu.teacher_no LIKE '%${teacherNo}%'
      </if>
      <if test="college != null and college != ''">
         and tu.college = #{college,jdbcType=VARCHAR}
      </if>
      <if test="major != null and major != ''">
         and tu.major = #{major,jdbcType=VARCHAR}
      </if>
      <if test="userName != null and userName != ''">
         and tu.user_name LIKE '%${userName}%'
      </if>
    </where>
    GROUP BY  tu.teacher_no
    </select>
  
</mapper>