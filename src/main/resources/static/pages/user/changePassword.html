<!DOCTYPE html>
<html>
<title>修改密码</title>
<head>
<link rel="stylesheet" type="text/css" media="screen" href="../../css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" media="screen" href="../../layui/css/layui.css">
	<link rel="stylesheet" type="text/css" media="screen" href="../../css/ry-ui.css">
	<link rel="stylesheet" type="text/css" media="screen" href="../../css/select2.css">
	<style>
		.layui-form-label{
			width: 110px;
		}
		#username1{
			/*width: 190px;*/
			text-align: left;
			padding: 9px 0;
		}
		.margin_left{
			margin-left:30%;
		}
		.width_300{
			width: 300px;
		}
		.no-records-found td{
			text-align: center!important;
		}
		.redstar{
			display: inline-block;
			color: red;
			font-size: 18px
		}
		.search-bar {
			box-shadow: 1px 1px 3px rgba(0,0,0,.2);
			width: 100%;
			background: #fff;
			border-radius: 5px;
			margin: 10px 0 30px 0;
			padding: 20px 0 10px 0;
		}
		.layui-inline .select,
		.layui-inline input {
			width: 190px;
			height: 33px;
			border-radius: 5px;
			border: #E6E6E6 solid 1px;
		}
		.layui-btn-sm {
			border-radius: 5px;
		}
		.layui-input-inline input {
			border-radius: 5px;
		}
	</style>
	<link rel="stylesheet" href="../../css/admin.css">

</head>
<body>
<div class="layui-fluid">
	<div class="layui-row layui-col-space15">
		<div class="layui-col-md12">
			<div class="layui-card">
<!--				<div class="layui-card-header">修改密码</div>-->
				<form class="layui-card-body" style="" pad15="" onsubmit="return false" id="form">
					<fieldset class="search-bar">
						<div class="layui-form-item margin_left">
							<label class="layui-form-label">用户名</label>
							<label class="layui-form-label" id="username1"></label>
<!--							<div class="layui-form-mid layui-word-aux">用户名不可修改</div>-->
							<div class="form-group layui-input-inline">
								<input class="layui-input width_300" placeholder="用户名" type="text" id="username" readonly="readonly" name="username"
									   data-bv-notempty="true"
									   data-bv-notempty-message="用户名不能为空" style="cursor: not-allowed;display: none">
							</div>
						</div>
						<div class="layui-form-item margin_left">
							<label class="layui-form-label">
<!--								<span class="redstar">*</span>-->
								原密码</label>
							<div class="form-group layui-input-inline">
								<input class="layui-input width_300" placeholder="原密码" type="password" name="oldPassword"
									   data-bv-notempty="true"
									   data-bv-notempty-message="原密码不能为空">
							</div>
						</div>
						<div class="layui-form-item margin_left">
							<label class="layui-form-label">
<!--								<span class="redstar">*</span>-->
								新密码</label>
							<div class="form-group layui-input-inline">
								<input maxlength="10" class="layui-input width_300" placeholder="新密码（10位以内）" type="password" name="newPassword" id="newPassword"
									   data-bv-notempty="true"
									   data-bv-notempty-message="密码不能为空"
									   data-bv-identical="true"
									   data-bv-identical-field="newPassword2"
									   data-bv-identical-message="两次密码不一致">
							</div>
						</div>
						<div class="layui-form-item margin_left">
							<label class="layui-form-label">
<!--								<span class="redstar">*</span>-->
								确认密码</label>
							<div class="form-group layui-input-inline">
								<input maxlength="10" class="layui-input width_300" placeholder="确认密码（10位以内）" type="password" name="newPassword2" id="newPassword2"
									   data-bv-notempty="true"
									   data-bv-notempty-message="再次输入新密码"
									   data-bv-identical="true"
									   data-bv-identical-field="newPassword"
									   data-bv-identical-message="两次密码不一致">
							</div>
						</div>
						<div class="layui-form-item" style="margin-left:36%;">
							<div class="layui-input-block">
								<button class="layui-btn" lay-submit="" lay-filter="setmypass" type="button" onclick="update()">确认修改</button>
							</div>
						</div>
					</fieldset>
				</form>
			</div>
		</div>
	</div>
</div>


	<script type="text/javascript" src="../../js/libs/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="../../js/jq.js"></script>
	<script type="text/javascript" src="../../layui/layui.js"></script>
	<script src="../../js/select2/select2.js"></script>
	<script type="text/javascript" src="../../js/plugin/bootstrapvalidator/bootstrapValidator.min.js"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script type="text/javascript">
	layui.use('layer', function(){
	    var layer = layui.layer;
	});
		function init(){
			$.ajax({
				type : 'get',
				url : httpUrl+'/users/current',
				async : false,
				data : $("#form").serialize(),
				success : function(data) {
					$("#username").val(data.username);
					$("#username1").html(data.username);
				}
			});
			
		}
		
		init();
	
		function update() {
            debugger;
			$('#form').bootstrapValidator();
			var bootstrapValidator = $("#form").data('bootstrapValidator');
			bootstrapValidator.validate();
		    if(!bootstrapValidator.isValid()){
			   return;
		    }

			console.log($("#form").serialize())
			$.ajax({
				type : 'put',
				url : '/users/'+$("#username").val(),
				data : $("#form").serialize(),
				success : function(data) {
				    console.log(data);
					layer.msg("修改成功", {shift: -1, time: 1000}, function(){
			            deleteCurrentTab();
			        });
				}
//                error: function (data) {
//				    console.log(data);
//                    layer.msg("修改失败", {shift: -1, time: 1000}, function(){
////                        deleteCurrentTab();
//                    });
//                }
			});
		}


	$(function () {
		//select2 渲染
		$('.select').select2({
			width: '190px',
		})
		$('.select2-container--default .select2-selection--single').css({
			"height":"33px",
			"border":"#E6E6E6 solid 1px",
			"border-radius":"5px"})
	})
	</script>
</body>
</html>